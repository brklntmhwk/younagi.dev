---
draft: published
level: 1
type: blog
title: hybridãƒ¢ãƒ¼ãƒ‰ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’Astro v5ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹ã¾ã§ã®ä¸€éƒ¨å§‹çµ‚
publishedAt: 2025-01-24T09:14:04.682Z
fmContentType: blog
updatedAt: 2025-01-31T09:50:53.099Z
description: ç ´å£Šç¥ã‚‚ã¨ã„Astro v5ã¸ã®å®Œå…¨ç§»è¡Œã‚’ç›®æŒ‡ã—ã€v4ã¨èœœæœˆé–¢ä¿‚ã§ã‚ã£ãŸå½“ã‚µã‚¤ãƒˆã‚‚ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’è©¦ã¿ãŸã€‚ãã®éš›ã€å¿…è¦ã«é§†ã‚‰ã‚Œã¦å¤‰æ›´ã—ãŸç‚¹ã‚’ã¾ã¨ã‚ã¦ãŠãã€‚
category:
  metadata: ja/categories
  slug: attempt
tags:
  metadata: ja/tags
  slugList:
    - astro
    - revisited
thumbnail: ğŸš€ğŸ”„ğŸ‘¹âš¡âˆ‘(O_Oï¼›)
---

## å°å…¥

{/* textlint-disable ja-technical-writing/no-doubled-joshi */}
2024 å¹´ 12 æœˆä¸Šæ—¬ã€[Astro](https://astro.build/) ãŒãƒãƒ¼ã‚¸ãƒ§ãƒ³[5.0.0](https://github.com/withastro/astro/releases/tag/astro%405.0.0) ã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã€‚ç´„ 1 å¹´ã¶ã‚Šã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã§ã‚ã‚‹ã€‚
å¤šãã®äººã«ã¨ã£ã¦ã€ã“ã‚Œã¯åœ°çƒã®è£å´ã®å‡ºæ¥äº‹ã®ã‚ˆã†ã§ã€ã‚¤ãƒã‚¤ãƒé–¢å¿ƒãŒæ¹§ã‹ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚ã—ã‹ã—ç§ã«ã¨ã£ã¦ã¯ä¸€å¤§äº‹ã§ã‚ã‚‹ã€‚ä½•ã‚’éš ãã†ã€ã“ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã¯ [Astro](https://astro.build/) ã§æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã ã€‚

ãã“ã§æ—©é€Ÿã€é¼»æ¯ã‚’è’ãã—ãªãŒã‚‰ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆãªã©ã®æ–‡æ›¸ã‚’èª­ã¿æ¼ã‚Šã€ã“ã®åº¦ã€æº€ã‚’æŒã—ã¦ç§»è¡Œä½œæ¥­ã«ç€æ‰‹ã—ãŸã€‚ã“ã‚Œã¯ãã®ä¸€éƒ¨å§‹çµ‚ã‚’åã‚ãŸè¨˜éŒ²ã§ã‚ã‚‹ã€‚

### æƒ³å®šèª­è€…

- Astro ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŠ±ãˆã¦ã„ã¦ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 5 ç³»ã¸ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã‚’æ¤œè¨ã—ã¦ã„ã‚‹
- Astro ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§éƒ¨åˆ†çš„ã« SSR ã‚’å°å…¥ã—ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦å‚è€ƒã«ã—ãŸã„
- ãªã‚“ã‹ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã‘ã©è¦‹å±Šã‘ã‚ˆã†ã¨æ€ã†

### ç¾æ™‚ç‚¹ã§ã®ç§ã®ç¿’ç†Ÿåº¦

è¨˜äº‹åŸ·ç­†æ™‚ç‚¹ã§ã®ç§ã®ç¿’ç†Ÿåº¦ã¯æ¬¡ã®é€šã‚Šã€‚

- Astro ã¨ã¯ã‹ã‚Œã“ã‚Œ 2 å¹´ç¨‹ã®ä»˜ãåˆã„ã«ãªã‚‹
- Astro ã¯ v3 ã®é ƒã‹ã‚‰ä½¿ã£ã¦ã„ã‚‹

## æœ¬é¡Œ

ç§ã®æ—§`astro.config.{js,mjs,ts}`ã«é–¢ã—ã¦ã€ç‰¹ç­†ã™ã¹ãç‚¹ã¯æ¬¡ã®é€šã‚Šã€‚

- ä¸€éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã§ SSR ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€[Cloudflare ã‚¢ãƒ€ãƒ—ã‚¿](https://docs.astro.build/en/guides/integrations-guide/cloudflare/)ã‚’è¿½åŠ ã—ã¦ã„ã‚‹
- ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã¯`output: "hybrid"`

ã¾ãŸç§»è¡Œã«éš›ã—ã¦ã¯ã€ä¸‹è¨˜ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ãŸã€‚

https://docs.astro.build/ja/guides/upgrade-to/v5/

### hybrid æ°‘ã¯ã©ã†ãªã‚‹ï¼Ÿ

ã¾ãšã¯å…ˆè¿°ã®`astro.config.{js,mjs,ts}`ãƒ•ã‚¡ã‚¤ãƒ«ã«é–¢ã™ã‚‹å¤‰æ›´ã‹ã‚‰ã€‚

Astro v5 ã§ã¯ã€`output: "hybrid"`ãŒå»ƒæ­¢ã•ã‚ŒãŸã€‚ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã¯ SSR ã¨ SSG ã®ã„ã„ã¨ã“ã©ã‚Šã‚’å¯èƒ½ã¨ã—ã€é™ã¨å‹•ã®ç‹­é–“ã§æºã‚Œå‹•ãã—ç§ã®ã‚ˆã†ãªäººé–“ã‚’é•·ãã«ã‚ãŸã£ã¦æ•‘æ¸ˆã—ã¦ããŸã€‚
ä»£ã‚ã‚Šã«ã€v5 ã‹ã‚‰ã¯"static"ã¨"server"ã®äºŒè€…æŠä¸€ã¨ãªã‚‹ã€‚ã“ã‚Œã¾ã§ã¯ã€ã“ã‚Œã‚‰ã¨"hybrid"ã‚’å«ã‚ãŸä¸‰æŠã§ã‚ã£ãŸãŒã€ä»Šå¾Œã¯"hybrid"ãŒ"static"ã«å¸åã•ã‚Œã‚‹å½¢ã¨ãªã‚‹ã‚ˆã†ã ã€‚

ã¤ã¾ã‚Šã€æˆ‘ã€… hybrid æ°‘ã¯ç²—æ–¹"static"ã¸ã®éæ›¿ãˆã‚’å¼·ã„ã‚‰ã‚Œã‚‹ãŒã€å®Ÿè³ªã“ã‚Œã¾ã§é€šã‚Šã®æš®ã‚‰ã—ã‚’ç¶šã‘ã‚‰ã‚Œã‚‹ã¨ã„ã†ã“ã¨ã ã€‚

> [!info]+
> static, hybrid, server ---> static(hybrid), server

ã¾ãŸã€æœ¬ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦ç‰¹ã«æŒ‡å®šã—ãªã‹ã£ãŸå ´åˆã¯ã€è‡ªå‹•çš„ã«`output: "static"`ãŒæ¡ç”¨ã•ã‚Œã‚‹ã¨ã®ã“ã¨ã ã€‚

ã‚ˆã£ã¦ã€æ¬¡ã®ã‚ˆã†ãªä¿®æ­£ã‚’ã—ãŸã€‚

```ts title="astro.config.ts" del={5}
import cloudflare from '@astrojs/cloudflare';
/* ... */

export default defineConfig({
  output: 'hybrid',
  adapter: cloudflare({
    platformProxy: {
      enabled: true,
      persist: true,
    },
  }),
  /* ... */
})
```

#### å°å™ºï¼šãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã«"server"ãƒ¢ãƒ¼ãƒ‰ã¨å‡ºåŠ›ã•ã‚Œã‚‹

ä»¥ä¸Šã§ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰å‘¨ã‚Šã®ä¿®æ­£ã¯å®Œäº†ãªã®ã ãŒã€æ°—ã«ãªã£ãŸç‚¹ã‚‚ã‚ã£ãŸã€‚

æˆ–ã‚‹æ—¥ã€æ¤…å­ã«ãµã‚“ãã‚Šè¿”ã£ã¦çœ¼å‰ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’ç¸¦æ–­ã™ã‚‹:ruby[ç€‘å¸ƒ(ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°)]ã‚’æ¼«ç„¶ã¨çœºã‚ã¦ã„ã‚‹ã¨ã€åˆ¹é‚£ã€æ€ã„ãŒã‘ãªã„è¨˜è¿°â”€â”€`output: "server"`â”€â”€ã‚’è¦‹å‡ºã—ãŸã€‚[^1] ã‚ã¾ã‚Šã®ä¸æ„æ‰“ã¡ã«ä¸€ç¬å‘†æ°—ã«å–ã‚‰ã‚Œã¦ã„ãŸãŒã€æš«ãçœºã‚ã¦ã„ã‚‹ã¨ã€ãƒšãƒ¼ã‚¸ã®ãƒ“ãƒ«ãƒ‰ãŒæ…Œã—ãå§‹ã¾ã£ãŸã€‚ã€Œæœã¦ãªãƒ»ãƒ»ï¼Ÿã€

[^1]: Astro v4 æ™‚ä»£ã«ã¯æƒ³å®šé€šã‚Š`output: "hybrid"`ãŒå‡ºåŠ›ã•ã‚Œã¦ã„ãŸ

Astro ãŒæä¾›ã™ã‚‹[Cloudflareã‚¢ãƒ€ãƒ—ã‚¿ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰](https://github.com/withastro/adapters/blob/641d7d588d2d77f519201e583f0275db4260575c/packages/cloudflare/src/index.ts)ã‚’ã‚ãŸã£ã¦ã¿ã‚‹ã¨ã€ã“ã‚Œã¯æ­£å¸¸ãªæŒ™å‹•ã§ã‚ã‚‹ã‚ˆã†ã ã€‚
å†·é™ã«ãªã£ã¦è€ƒãˆã¦ã¿ã‚‹ã¨ã€ç§ãŒç›®æ’ƒã—ãŸã‚ã®ãƒ­ã‚°ã¯[Astroã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³](https://docs.astro.build/ja/guides/integrations-guide/)ã¨ã—ã¦ã® Cloudflare ã‚¢ãƒ€ãƒ—ã‚¿ãŒ"server"ã¨æŒ‡å®šã—ãŸã‚‚ã®ã‚’å‡ºåŠ›ã—ãŸã«éããªã„ã€‚ã‚¢ãƒ€ãƒ—ã‚¿ã¯ SSR ãŒå¿…è¦ãªã‚µã‚¤ãƒˆã‚’å„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ç‚ºã®æ¶ã‘æ©‹ã§ã‚ã‚‹ã‹ã‚‰ã—ã¦ã€ã€Œ"server"ãƒ¢ãƒ¼ãƒ‰ã§å‹•ã„ã¦ã¾ã™ã‚ˆã€ã¨:ruby[å®£(ã®ãŸã¾)]ã†ã®ã¯è‡ªç„¶ãªè©±ã§ã¯ã‚ã‚‹ã€‚ãã—ã¦ã€:ruby[ä¸€åº¦(ã²ã¨ãŸã³)]ãƒˆãƒ³ãƒãƒ«ã‚’æŠœã‘ã‚‹ã¨ã€ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹å…¨ä½“ã¨ã—ã¦ã¯"static"ã§ã‚ã‚‹ã¨ã€‚

ã¨ã©ã®ã¤ã¾ã‚Šã€`output: "server"`ã®ãƒ­ã‚°ã¯æ°—ã«ã—ãªãã¦ã‚ˆã„ã¨ã„ã†ã“ã¨ã ã€‚ãƒ¢ãƒ¼ãƒ‰ãŒ 2 ã¤ã«çµã‚‰ã‚Œã¦ã‚¹ãƒƒã‚­ãƒªã—ãŸä¸€æ–¹ã§ã€ã“ã®è¾ºã‚Šã«ã¤ã„ã¦ã¯ã€Œå°‘ã—ç´›ã‚‰ã‚ã—ããªã£ãŸã‹ã‚‚ãƒ»ãƒ»ï¼Ÿã€ã¨ã„ã†æ„Ÿã‚’ç¦ã˜å¾—ãªã„ã€‚

### Content Collections ãŒ Content Layer ã«å¤‰æ›´

ä»Šå›ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ãŠã„ã¦ã€æœ€å¤§ã®å±±å ´ãŒã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å‘¨ã‚Šã®ä¿®æ­£ã ã€‚
ã€Œã¡ã‚‡ã£ã¨åå‰ã‚’ã‚«ãƒƒã‚³ã‚ˆãã—ã¦ã¿ã¾ã—ãŸï¼ã€ã¨ã„ã£ãŸç”Ÿã¬ã‚‹ã„å¤‰æ›´ã§ã¯ãªã„ã€‚ç ´å£Šç¥ã€ã“ã“ã«æ¥µã¾ã‚Œã‚Šã€‚[^2]

[^2]: ç ´å£Šç¥ã§ã¯ã‚ã‚‹ãŒã€æš´å›ã§ã¯ãªã„ã€‚
ãã®è¨¼æ‹ ã«ã€Astro v5 ã§ã‚‚å¾“æ¥ã® Content Collections ã‚’ä½¿ã„ç¶šã‘ã‚‹ã“ã¨ã¯å¯èƒ½ã ã€‚`astro.config.{js,mjs,ts}`ã®`defineConfig`ã§`legacy.collection`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’`true`ã¨ã™ã‚Œã° OK ã ã€‚å¿ƒå„ªã—ãç ´å£Šç¥ã§ã‚ã‚‹ã€‚

#### config ãŒ content.config ã«å¤‰æ›´

ã¾ãšç¬¬ä¸€ã«ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¨é…ç½®å ´æ‰€ãŒå¤‰æ›´ã¨ãªã£ãŸã€‚ã“ã‚Œã¾ã§ã¯ã€`src/content/config.ts`ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨åŒéšå±¤ã«é…ç½®ã•ã‚Œã¦ã„ãŸãŒã€v5 ã§ã¯`src/content.config.ts`ã®ã‚ˆã†ã«`src`ç›´ä¸‹ã«é…ç½®ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚

#### IN: loader, OUT: type

æ¬¡ã«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å®šç¾©æ–¹æ³•ãŒå¤‰æ›´ã•ã‚ŒãŸã€‚`defineCollection`é–¢æ•°ã«æ¸¡ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒã€ã“ã®é€šã‚Šäº¤ä»£ã¨ãªã£ãŸã€‚

```ts title="src/content.config.ts" del={5,41,50} ins={2,6,42-45,51}
import { defineCollection, reference, z } from 'astro:content';
import { glob } from 'astro/loaders';

const blog = defineCollection({
  type: 'content',
  loader: glob({ pattern: '**/*.mdx', base: './src/content/blog' }),
  schema: z.object({
    title: z.string(),
    description: z.string().optional(),
    publishedAt: z.coerce.date(),
    updatedAt: z.coerce.date().optional(),
    category: z.object({
      metadata: reference('categories'),
      slug: z.string(),
    }),
    tags: z.object({
      metadata: reference('tags'),
      slugList: z.array(z.string()).optional(),
    }),
    draft: z.enum(['draft', 'in progress', 'published']),
    level: z
      .union([
        z.literal(1),
        z.literal(2),
        z.literal(3),
        z.literal(4),
        z.literal(5),
      ])
      .optional(),
    thumbnail: z.string().optional(),
  }),
});

const taxonomySchema = z.object({
  title: z.string(),
  slug: z.string(),
  ruby: z.string(),
});

const categories = defineCollection({
  type: 'data',
  loader: glob({
    pattern: '**/*.{yml,yaml}',
    base: './src/content/categories',
  }),
  schema: z.array(taxonomySchema),
});

const tags = defineCollection({
  type: 'data',
  loader: glob({ pattern: '**/*.{yml,yaml}', base: './src/content/tags' }),
  schema: z.array(taxonomySchema),
});

/* ... */

export const collections = { blog, categories, tags, /* ... */ };
```

å¾“æ¥ã®`type: 'content' | 'data'`ãŒå»ƒæ­¢ã•ã‚Œã€`glob`ã¨`file`ã¨ã„ã†é–¢æ•°ã‚’ä½¿ã£ã¦ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹æ–¹å¼ã«ãªã£ãŸã€‚

> [!info]
> `glob`ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŒ‡å®šã«ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã‚’ä½¿ç”¨ã§ãã‚‹
> `file`ã¯å˜ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒ‡å®šã™ã‚‹ã‚‚ã®

#### slug ãŒ id ã«å¤‰æ›´

æœ€å¾Œã«ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ãƒ©ãƒƒã‚°ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ç‚ºã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå¤‰æ›´ã•ã‚ŒãŸã€‚ã“ã‚Œã¾ã§`slug`ã ã£ãŸã‚‚ã®ãŒ`id`ã«ãªã£ãŸã€‚

ä¾‹ãˆã°ã€å…ˆè¿°ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§å®šç¾©ã—ãŸãƒ–ãƒ­ã‚°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã€[å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](https://docs.astro.build/ja/guides/routing/#%E5%8B%95%E7%9A%84%E3%83%AB%E3%83%BC%E3%83%86%E3%82%A3%E3%83%B3%E3%82%B0)ã§è¨˜äº‹æ¯ã«å€‹åˆ¥ã«å‡ºã—åˆ†ã‘ãŸã„ã¨ã„ã†å ´åˆã€‚ã“ã‚Œã¾ã§ã¯`src/pages/blog/[slug].astro`ã®ã‚ˆã†ã«ãƒšãƒ¼ã‚¸ã®ãƒ‘ã‚¹ã‚’è¨­å®šã—ã¦ã„ãŸãŒã€v5 ã§ã¯`src/pages/blog/[id].astro`ã®ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã“ã¨ã«ãªã‚‹ã€‚ã“ã‚Œã«ä¼´ã„ã€ãƒšãƒ¼ã‚¸ã®ä¿®æ­£ã‚’ä¸‹è¨˜ã®é€šã‚Šè¡Œã£ãŸã€‚

```astro title="src/pages/blog/[id].astro" del={6,15,18} ins={7,16,19}
---
import { render } from 'astro:content';
import BlogLayout from '@/layouts/BlogLayout.astro';
import { getSortedContentEntries } from '@/lib/collections/contents';
import { mdxComponents } from '@/lib/mdx-components';
import { getSlugWithoutLocale } from '@/utils/get-slug-without-locale';
import { getIdWithoutLocale } from '@/utils/get-id-without-locale';
import { defaultLocale } from '@/utils/i18n/data';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const entries = await getSortedContentEntries('blog', defaultLocale);

  return entries.map((entry) => {
    const slug = getSlugWithoutLocale(entry.slug);
    const id = getIdWithoutLocale(entry.id);

    return { params: { slug }, props: { entry } };
    return { params: { id }, props: { entry } };
  });
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content, headings } = await render(entry);
---

<BlogLayout entry={{ ...entry }} {headings}>
  <Content components={mdxComponents} />
</BlogLayout>
```

ã—ã‹ã—ã€"id"ã‚ˆã‚Šã‚‚"slug"ã®æ–¹ãŒå‘½åã¨ã—ã¦å„ªã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã ã‚ã†ã€‚ãƒ–ãƒ­ã‚°ã¯ãã®å…¸å‹ä¾‹ã§ã€`src/pages/blog/[slug].astro`ã®æ–¹ãŒã—ã£ãã‚Šãã‚‹ã¨æ€ã†äººã¯ä¸€å®šæ•°å±…ã‚‹ã¨æ¨å¯Ÿã™ã‚‹ã€‚ãã†ã„ã£ãŸå ´åˆã¯ã€æ¬¡ã®ã‚ˆã†ãªæ–¹æ³•ã§å¯¾å¿œã—ã¦ã‚‚ã‚ˆã„ã ã‚ã†ã€‚

```astro title="src/pages/blog/[slug].astro" {14}
---
import { getSortedContentEntries } from '@/lib/collections/contents';
import { getIdWithoutLocale } from '@/utils/get-id-without-locale';
import { defaultLocale } from '@/utils/i18n/data';
import type { GetStaticPaths } from 'astro';
/* ... */

export const getStaticPaths = (async () => {
  const entries = await getSortedContentEntries('blog', defaultLocale);

  return entries.map((entry) => {
    const id = getIdWithoutLocale(entry.id);

    return { params: { slug: id }, props: { entry } };
  });
}) satisfies GetStaticPaths;

/* ... */
---

{/* ... */}
```

#### render ãƒ¡ã‚½ãƒƒãƒ‰ãŒé–¢æ•°ã¨ã—ã¦ç‹¬ç«‹

ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹éš›ã«ä½¿ç”¨ã—ã¦ã„ãŸ`render`ãŒã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã¯ãªãé–¢æ•°ã¨ã—ã¦ç‹¬ç«‹ã™ã‚‹ã“ã¨ã«ãªã£ãŸã€‚

```astro title="src/pages/blog/[id].astro" del={21} ins={2,22}
---
import { render } from 'astro:content';
import BlogLayout from '@/layouts/BlogLayout.astro';
import { getSortedContentEntries } from '@/lib/collections/contents';
import { mdxComponents } from '@/lib/mdx-components';
import { getIdWithoutLocale } from '@/utils/get-id-without-locale';
import { defaultLocale } from '@/utils/i18n/data';
import type { GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  const entries = await getSortedContentEntries('blog', defaultLocale);

  return entries.map((entry) => {
    const id = getIdWithoutLocale(entry.id);

    return { params: { id }, props: { entry } };
  });
}) satisfies GetStaticPaths;

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
const { Content, headings } = await render(entry);
---

<BlogLayout entry={{ ...entry }} {headings}>
  <Content components={mdxComponents} />
</BlogLayout>
```

### env.d.ts ã®æ‰±ã„ãŒå¤‰æ›´

ã“ã‚Œã¾ã§ã¯ã€è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹å‹ã®æ¨è«–ã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©ã«éš›ã—ã¦`src/env.d.ts`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…è¦ã§ã‚ã£ãŸãŒã€v5 ã§ã¯:ruby[å¿…ãšã—ã‚‚å¿…è¦ã§ã¯ãªããªã£ãŸ(â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢)]ã€‚

å¾“æ¥ã®`src/env.d.ts`ã§ã¯ä¸‹è¨˜ã®ã‚ˆã†ãªè¨˜è¿°ãŒå¿…è¦ã§ã‚ã£ãŸãŒã€v5 ã§ã¯`.astro/types.d.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã®ã¾ã¾å‹æ¨è«–ã«ä½¿ç”¨ã™ã‚‹æ–¹é‡ã«ãªã£ãŸã‚ˆã†ã ã€‚

```ts title="src/env.d.ts"
/// <reference path="../.astro/types.d.ts" />
/// <reference types="astro/client" />

// ä»¥ä¸‹ã€ã‚«ã‚¹ã‚¿ãƒ ã§å‹å®šç¾©ãªã©ãŒã‚ã‚Œã°è¿½åŠ 
```

ã“ã‚Œã«ä¼´ã„ã€é–‹ç™ºæ™‚ã«å‹æ¨è«–ã®æ©æµã«ä¸ã‚‹ç‚ºã€æ¬¡ã®ã‚ˆã†ãªå¤‰æ›´ã‚’åŠ ãˆãŸã€‚

```json title="tsconfig.json" ins={7-10}
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "astro/tsconfigs/strictest",
  "compilerOptions": {
    /* ... */
  },
  "include": [
    ".astro/types.d.ts",
    "**/*"
  ],
  "exclude": [
    "./dist",
    "./node_modules",
  ],
}
```

ã¨ã¯è¨€ãˆã€ç§ã®å ´åˆã¯`src/env.d.ts`ã‚’æ¶ˆã™ã“ã¨ã¯ã§ããªã‹ã£ãŸã€‚åŒãƒ•ã‚¡ã‚¤ãƒ«å†…ã« Cloudflare Turnstile ã‚„ D1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã®ã‚«ã‚¹ã‚¿ãƒ å‹å®šç¾©ã‚’è¿½åŠ ã—ã¦ã„ãŸã‹ã‚‰ã ã€‚ã“ã®ã‚ˆã†ãªã‚±ãƒ¼ã‚¹ã‚„ã€ãã‚‚ãã‚‚`tsconfig.json`ã‚’ç½®ã„ã¦ã„ãªã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`src/env.d.ts`ã¯ä¾ç„¶å¿…è¦ã¨ãªã‚‹ã‚ˆã†ã ã€‚
å…ˆã»ã©ã€Œ:ruby[å¿…ãšã—ã‚‚å¿…è¦ã§ã¯ãªããªã£ãŸ(â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢ â€¢)]ã€ã¨ã„ã†å›ã‚Šãã©ã„è¡¨ç¾ã‚’ã—ãŸã®ã«ã¯ã€ã“ã†ã—ãŸç†ç”±ãŒã‚ã£ãŸã€‚

## çµã³

æ€ã„ã®å¤–ç§»è¡Œã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã£ãŸã€‚
ã¨ã„ã†ã®ã‚‚ã€v5 ã§æ­£å¼ã«è¿½åŠ ã•ã‚ŒãŸã€Œ[Server Islands](https://docs.astro.build/en/guides/server-islands/)ã€ã®å°å…¥ã‚‚è©¦ã¿ã¦ã„ãŸãŒã€çµå±€ä¸Šæ‰‹ãã„ã‹ãšãã‚Œãªã‚Šã«æ™‚é–“ã‚’è²»ã‚„ã—ã¦ã—ã¾ã£ãŸã‹ã‚‰ã ã€‚

ä»Šå›ã®ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã«ã¤ã„ã¦ã€ç¾æ™‚ç‚¹ã§ã¯ã¾ã ç›®ã‚’è¦‹å¼µã‚‹ç¨‹ã®æ©æµã¯å®Ÿæ„Ÿã§ãã¦ã„ãªã„ãŒã€ä»Šå¾Œã‚µã‚¤ãƒˆã‚’æ”¹å–„ã—ã¦ã„ãä¸­ã§:ruby[ç ´å£Šç¥(v5)]ã®æœ¬é ˜ãŒå£é–“è¦‹ãˆã‚Œã°å¬‰ã—ã„ã€‚
