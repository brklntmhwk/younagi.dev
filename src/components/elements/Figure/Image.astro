---
import { Picture } from 'astro:assets';

type Props = {
  alt: string;
  placeholder?: string;
  src: string | ImageMetadata;
};

const { alt, placeholder, src, ...props } = Astro.props;

// Generate a placeholder for and optimize the image if the placeholder is "undefined" here. (This is the case whenever the image comes from outside the scope of the remark processor)
---

{
  typeof src === 'string' ? (
    <img {alt} {src} {...props} />
  ) : (
    <figure>
      <Picture
        {alt}
        {src}
        class="picture"
        formats={['avif']}
        widths={[240, 540, 720, src.width]}
        pictureAttributes={{
          style: {
            aspectRatio: `${src.width} / ${src.height}`,
            margin: "0 auto",
            maxHeight: "100%"
          }
        }}
        {...props}
      />
      <figcaption>{alt}</figcaption>
    </figure>
  )
}
<style define:vars={{ blurUrl: `url(${placeholder})` }}>
  figure {
    display: flex;
    flex-direction: column;
    gap: 0.375rem;
    place-items: center;
    margin: 1.75rem 0;
  }
  figcaption {
    font-size: 0.95rem;
  }
  .picture {
    object-fit: contain;
    color: transparent;
    background-image: var(--blurUrl);
    background-size: cover;
    background-position: 50% 50%;
    background-repeat: no-repeat;
  }
</style>
