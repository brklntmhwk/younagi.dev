---
title: Astro, Cloudflare Pages, Front Matter CMS で個人ブログを作った
description: Astro, Cloudflare Pages, Front Matter CMS の構成で開発した個人ブログについて、重要なポイントを拾いつつ説明する
publishedAt: 2024-05-13T04:50:36.513Z
modifiedAt: 2024-05-13T04:50:40.350Z
draft: published
type: blog
category:
  metadata: ja/categories
  slug: learning
tags:
  metadata: ja/tags
  slugList:
    - astro
    - typescript
    - front-matter-cms
    - cloudflare
---

## 導入

個人ウェブサイト開発に4ヶ月程費やし、何とか最低限見せられるレベルまで完成しました。その開発体験についてポイントをかいつまんで書きます。

当サイトのソースコードに興味のある方は、[当サイトの Github レポジトリ](https://github.com/brklntmhwk/younagi.dev)をご覧ください。

## 本題

### Astro

基本はAstroの機能範囲で実装し、例外部分は新進気鋭のJSフレームワーク「SolidJS」で実装しています。もちろん全て TypeScript(と TSX) です。

#### 全文検索

Rust製の静的検索ライブラリである[Pagefind](https://pagefind.app/)の力を借りることにしました。軽量、高速、そして導入が簡単！

#### 多言語対応 (i18n)

[公式のドキュメント](https://docs.astro.build/ja/recipes/i18n/)に記載されている手順通りに、言語ごとのディレクトリを作成しました。(私の場合は `en` と `ja` です。一つのファイルに対して、言語の数と同じだけ同名のファイルを作成する必要があります)

Astro の [Content Collections](https://docs.astro.build/ja/guides/content-collections/) は Markdown/MDX 形式だけでなく、YAML や JSON形式にも対応しています。私は記事以外の翻訳文字列群の保存にYAML形式を選びました。非常に簡潔で好きです。

![content ディレクトリツリー](../../../assets/images/content-dir.png)

Content Collectionsの詳しいカスタマイズについては、[Astro公式ドキュメント](https://docs.astro.build/ja/guides/content-collections/)をご覧あれ。

#### OG 画像 (Open Graph)

When it comes to individual entries of blog and news, their OG Images are dynamically generated via [the Astro API endpoints](https://docs.astro.build/en/guides/endpoints/).
It's dynamic in the sense that every path of OG Images is generated dynamically referring to [the Astro dynamic routes](https://docs.astro.build/en/guides/routing/#dynamic-routes), but static in the sense that they are generated at build time.

Along the way, [the satori library](https://github.com/vercel/satori) generates an svg image based on the HTML & CSS input, and then [the Sharp library](https://sharp.pixelplumbing.com/) optimizes and formats it to a PNG image. You can access them via the dynamically generated paths. Here's an example.

![ OG Image example of this page ](../../../assets/images/og-image-example.png)

#### Remark/Rehype プラグイン

In my website, all contents are written in the Markdown/MDX format, but the basic syntax is limited to an absolute minimum, so I decided to use those off-the-shelf [Remark](https://unifiedjs.com/explore/project/remarkjs/remark/) and [Rehype](https://unifiedjs.com/explore/project/rehypejs/rehype/) plugins or make them on my own to extend it to the extent I feel comfortable writing stuff.

##### KaTex

$\KaTeX$ はウェブページ上で数式などをきれいに表示してくれます。その呪文を数式に変換するのに、[remark-math と rehype-katex](https://github.com/remarkjs/remark-math/tree/main/packages/rehype-katex)を追加しました。

入力

```Markdown
$$
x = {-b \pm \sqrt{b^2-4ac} \over 2a}
$$
$$
( \sum_{k=1}^{n} a_k b_k )^2 \leq ( \sum_{k=1}^{n} {a_k}^2 ) ( \sum_{k=1}^{n} {b_k}^2 )
$$
$$
\int_{0}^{1} f(x) \ dx
= \lim_{n \to \infty} \dfrac{1}{n} \sum_{k=0}^{n-1} f \left (\dfrac{k}{n} \right)
$$
```

出力

$$
x = {-b \pm \sqrt{b^2-4ac} \over 2a}
$$

$$
( \sum_{k=1}^{n} a_k b_k )^2 \leq ( \sum_{k=1}^{n} {a_k}^2 ) ( \sum_{k=1}^{n} {b_k}^2 )
$$

$$
\int_{0}^{1} f(x) \ dx
= \lim_{n \to \infty} \dfrac{1}{n} \sum_{k=0}^{n-1} f \left (\dfrac{k}{n} \right)
$$

##### コードブロック

As a developer, sharing some code examples is inevitable. [The rehype-pretty-code](https://rehype-pretty.pages.dev/) did all the heavy lifting in adding code syntax highlighting for me. Incidentally, the syntax highlighter is [Shiki](https://shiki.style/).

```astro title="example.astro"
---
type Props = {
  title: string
}

const { title } = Astro.props
---

<div>{`This is an example page titled ${title}.`}</div>
```

##### コールアウト

数年間 [Obsidian](https://obsidian.md/) をナレッジベースとして愛用していて、マークダウン記法で書ける[コールアウト](https://help.obsidian.md/Editing+and+formatting/Callouts)が好きでした。このブログでも使いたくなり、実装しました。
実装に際して、こだわった点は次の通りです。

- 開閉可能
  - コールアウトタイトルの横に "+" もしくは "-" のマークがある場合、そのコールアウトは開閉可能と判断される
- 多彩な種類と色
- 入れ子構造にできる

以下がその例です。

```Markdown title="Info callout"
> [!info]+Info
> Info callout example. (Expanded by default)
```

> [!info]+Info
> Info callout example. (Expanded by default)

---

```Markdown title="Caution callout"
> [!caution]-Caution
> Caution callout example. (Folded by default)
```

> [!caution]-Caution
> Caution callout example. (Folded by default)

---

```Markdown title="Check callout"
> [!check] Check
> Check callout example. (No expansion/fold)
```

> [!check] Check
> Check callout example. (No expansion/fold)

---

##### OEmbed(埋め込み)

URLs pasted directly morphs into embedded frames if they are compatible with embedding media. I manually added the integrations with Canva, YouTube, and Google Slides. Other than them, URLs are transformed in accordance with [the OEmbed](https://oembed.com/) format.
Incidentally, [the unfurl library](https://github.com/jacktuck/unfurl) fetches the media metadata necessary for the format behind the scenes.

YouTube

https://www.youtube.com/watch?v=dsTXcSeAZq8

Spotify

https://open.spotify.com/intl-ja/track/04z1fwsw1gXI8HWQpoETa9?si=862c02d3e52a49b0

Canva

https://www.canva.com/design/DAGKC41Tjws/zSEw1hvi9r30o5KiF96AGA/view

Google Slides

https://docs.google.com/presentation/d/1CbeSiVYta0VTuENQ-25OLcIV5vK8pkcBJ-8DfKqlE2I/edit?usp=sharing

##### リンクカード

#### お問い合わせフォーム

### Cloudflare

#### Cloudflare Pages

[Next.js](https://nextjs.org/) に執心だった頃、 私のお気に入りのホスティングサービスは [Vercel](https://vercel.com/) でしたが、Astroへの移行に際して、見直す必要があると感じました。そしてたどり着きました。[Cloudflare Pages](https://developers.cloudflare.com/pages/)という結論に。

##### どうして Cloudflare Pages?

Cloudflare Pagesをホスティング先に選んだのには次のような理由がありました。

- 寛大なフリープラン
  - 月あたりの帯域幅上限が無制限という素晴らしさ (2024年5月9日現在)
- 非常に高速なデプロイ
- ドメイン用のカスタムEメールアドレスが取得できる
- 独自ドメイン取得可能 (有料)

フリープランでも当サイトのような小規模プロジェクトならば十分運用可能だと思います。この点が最も魅力的でした。

#### Cloudflare D1

### Front Matter CMS

フレームワーク選定の他には、CMS(Content Management System)選定にもかなりの時間を要します。私は [Front Matter CMS](https://frontmatter.codes/) に惹かれました。理由は次の通りです。

- ローカルで記事の執筆や保存ができる
- マークダウン/MDX形式

VS Code の拡張機能であり、ローカルで動くという点で、他のヘッドレスCMSとは一線を画しています。つまり、コードの修正や記事の執筆、サイトのデプロイなどの作業が VS Code エディタで一元化できます。 これは特に開発者にとって大きなメリットとなるのではないでしょうか。

初期セットアップについては[Front Matter 公式ドキュメント](https://frontmatter.codes/docs/getting-started)をご覧あれ。手順通りに進めれば、Astroの `content` フォルダを自動で検知し、その中身に応じて `frontmatter.json` に各コンテンツの項目の定義などを書き出してくれます。基本、Front Matter CMSの設定はプロジェクトルート直下に置かれたこのファイルで管理します。

#### Front Matter CMS のカスタマイズ

`frontmatter.json` では、カスタマイズについて2点重要なポイントがあります。

- `frontMatter.content.publicFolder`: デフォルトでは `public` フォルダを参照します。私の場合はAstroが画像最適化の為に提供する[Asset](https://docs.astro.build/ja/guides/images/)を使いたかったので、参照先を `src/assets/images/` に変更しました
- `frontMatter.content.i18n`: Front Matter CMS は多言語化機能(i18n)も有しています。この設定では、言語ごとにディレクトリ名との紐づけを行えます

私のダッシュボードはこのような感じです。他のCMSに匹敵する見栄えではないでしょうか。

![ 私の Front Matter CMS ダッシュボード (リスト表示) ](../../../assets/images/front-matter-cms-dashboard.png)

![ 私の Front Matter CMS 編集モード画面 ](../../../assets/images/front-matter-cms-editing.png)

## 終結
