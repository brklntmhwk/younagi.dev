---
title: Build a Personal Website with Astro, Cloudflare Pages, D1, and Front Matter CMS
description: A quick tour of my personal blog built with Astro, Cloudflare Pages, D1, and Front Matter CMS.
publishedAt: 2024-05-13T04:50:45.589Z
modifiedAt: 2024-05-23T06:40:18.275Z
draft: published
type: blog
category:
  metadata: en/categories
  slug: learning
tags:
  metadata: en/tags
  slugList:
    - astro
    - front-matter-cms
    - cloudflare
---

## Intro

It took me 4 months or so to get it done to build my personal website up to a minimum decent level. Here, you'll join a quick tour of the whole development experience.

If you're interested in the code behind my website, see [my Github repo](https://github.com/brklntmhwk/younagi.dev).

## Main

### Astro

Basically, I managed to develop it with what Astro offers, but when it comes to some exceptions, I used SolidJS, the up-and-coming JS framework. It goes without saying that all written in TypeScript (and TSX).

#### Full text search

I used [Pagefind](https://pagefind.app/), a Rust based static search library. It's lightweight, lightning fast, and easy to use. It's also self-contained on the browser without needing to interact with server. The secret is that static files under the designated directory to be generated at build time, are read and their index files are generated in advance.

Along the way, I got hung up on some key points:

- Callable via a shortcut key
  - Press `Ctrl + K` if you're on PC
- Custom keyword highlighting
- Accessible from everywhere
  - The search button is placed in the navigation bar

#### Internationalization (i18n)

It's all directory-based manual translation built on top of [the Astro Content Collections API](https://docs.astro.build/en/guides/content-collections/).

I was able to achieve it thanks to [the official doc](https://docs.astro.build/ja/recipes/i18n/). First, I followed the steps and created locale directories (`en` and `ja`, in my case.) You need to create as many files as the number of languages for the same content.

The Content Collections API covers YAML and JSON formats as well as those of Markdown and MDX. I chose YAML for storing translation data because of its brevity.

![content directory tree](../../../assets/images/content-dir.png)

#### OG Image (Open Graph)

When it comes to individual entries of blog and news, their OG Images are dynamically generated via [the Astro API endpoints](https://docs.astro.build/en/guides/endpoints/).
It's dynamic in the sense that every path of OG Images is generated dynamically referring to [the Astro dynamic routes](https://docs.astro.build/en/guides/routing/#dynamic-routes), but static in the sense that they are generated at build time.

Along the way, [the satori library](https://github.com/vercel/satori) generates an svg image based on the HTML & CSS input, and then [the Sharp library](https://sharp.pixelplumbing.com/) optimizes and formats it to a PNG image. You can access them via the dynamically generated paths. Here's an example.

```txt title="The path example"
https://younagi.dev/api/og/blog/astro-website.png
```

![ OG Image example of this page](../../../assets/images/og-image-example.png)

#### Remark/Rehype Plugins

In my website, all contents are written in the Markdown/MDX format, but the basic syntax is limited to an absolute minimum, so I decided to use those off-the-shelf [Remark](https://unifiedjs.com/explore/project/remarkjs/remark/) and [Rehype](https://unifiedjs.com/explore/project/rehypejs/rehype/) plugins or make them on my own to extend it to the extent I feel comfortable writing stuff.

##### KaTex

$\KaTeX$ beautifully styles mathematical expressions on a web page. To render the magic spells into mathematical expressions, I added [the remark-math and rehype-katex](https://github.com/remarkjs/remark-math/tree/main/packages/rehype-katex) plugins.

Input

```Markdown
$$
x = {-b \pm \sqrt{b^2-4ac} \over 2a}
$$
$$
( \sum_{k=1}^{n} a_k b_k )^2 \leq ( \sum_{k=1}^{n} {a_k}^2 ) ( \sum_{k=1}^{n} {b_k}^2 )
$$
$$
\int_{0}^{1} f(x) \ dx
= \lim_{n \to \infty} \dfrac{1}{n} \sum_{k=0}^{n-1} f \left (\dfrac{k}{n} \right)
$$
```

Output

$$
x = {-b \pm \sqrt{b^2-4ac} \over 2a}
$$

$$
( \sum_{k=1}^{n} a_k b_k )^2 \leq ( \sum_{k=1}^{n} {a_k}^2 ) ( \sum_{k=1}^{n} {b_k}^2 )
$$

$$
\int_{0}^{1} f(x) \ dx
= \lim_{n \to \infty} \dfrac{1}{n} \sum_{k=0}^{n-1} f \left (\dfrac{k}{n} \right)
$$

##### Code blocks

As a developer, sharing some code examples is inevitable. [The rehype-pretty-code](https://rehype-pretty.pages.dev/) did all the heavy lifting in adding code syntax highlighting for me. Incidentally, the syntax highlighter is [Shiki](https://shiki.style/).

```astro title="example.astro"
---
type Props = {
  title: string
}

const { title } = Astro.props
---

<div>{`This is an example page titled ${title}.`}</div>
```

##### Callouts

I've been using [Obsidian](https://obsidian.md/) for years as my knowledge base and love [the callout component](https://help.obsidian.md/Editing+and+formatting/Callouts). I wanted to have it here too so embarked on developing it on my own.
Along the way, I got hung up on some key points:

- Expandable/foldable
  - If there are either "+" or "-" mark beside the callout title, it's regarded as expandable/foldable
  - Nested callouts are also expanded or folded when the outer callout toggles
- Various types and colors
- Able to be nested

Below are some examples.

```Markdown title="Info callout"
> [!info]+Info
> Info callout example. (Expanded by default)
```

> [!info]+Info
> Info callout example. (Expanded by default)

---

```Markdown title="Caution callout"
> [!warning]-warning
> Caution callout example. (Folded by default)
```

> [!warning]-Caution
> Caution callout example. (Folded by default)

---

```Markdown title="Check callout"
> [!check] Check
> Check callout example. (No expansion/fold)
```

> [!check] Check
> Check callout example. (No expansion/fold)

---

```Markdown title="Nested callout"
> [!note]+
> Callout
>
> > [!info]+
> > Nested callout
> >
> > > [!warning]+
> > > further nested callout

> [!question]+
> Question!
>
> > [!failure]+
> > Failure!
> >
> > > [!check]+
> > > Check!
> > >
> > > > [!quote]+
> > > > Quote!
```

> [!note]+
> Callout
>
> > [!info]+
> > Nested callout
> >
> > > [!warning]+
> > > further nested callout

> [!question]+
> Question!
>
> > [!failure]+
> > Failure!
> >
> > > [!check]+
> > > Check!
> > >
> > > > [!quote]+
> > > > Quote!

##### OEmbed

URLs pasted directly morphs into embedded frames if they are compatible with embedding media. I manually added the integrations with Canva, YouTube, and Google Slides. Other than them, URLs are transformed in accordance with [the OEmbed](https://oembed.com/) format.
Incidentally, [the unfurl library](https://github.com/jacktuck/unfurl) fetches the media metadata necessary for the format behind the scenes.

###### YouTube

```txt
https://www.youtube.com/watch?v=dsTXcSeAZq8
```

https://www.youtube.com/watch?v=dsTXcSeAZq8

###### Spotify

```txt
https://open.spotify.com/intl-ja/track/04z1fwsw1gXI8HWQpoETa9?si=862c02d3e52a49b0
```

https://open.spotify.com/intl-ja/track/04z1fwsw1gXI8HWQpoETa9?si=862c02d3e52a49b0

###### Canva

```txt
https://www.canva.com/design/DAGKC41Tjws/zSEw1hvi9r30o5KiF96AGA/view
```

https://www.canva.com/design/DAGKC41Tjws/zSEw1hvi9r30o5KiF96AGA/view

###### Google Slides

```txt
https://docs.google.com/presentation/d/1CbeSiVYta0VTuENQ-25OLcIV5vK8pkcBJ-8DfKqlE2I/edit?usp=sharing
```

https://docs.google.com/presentation/d/1CbeSiVYta0VTuENQ-25OLcIV5vK8pkcBJ-8DfKqlE2I/edit?usp=sharing

##### Link cards

When it comes to other bare links than OEmbed compatible ones, they are transformed into a link card as a fallback. I made up a Remark plugin for this coupled with that for the OEmbed.

[the unfurl library](https://github.com/jacktuck/unfurl) does great work under the hood here again. It fetches the OG image and other site metadata via the URL.

```txt
https://younagi.dev
```

https://younagi.dev

#### Contact Form

What I spent a considerable amount of time racking my brain was the contact form. Having gone through several major changes, it's ended up with SolidJS and TSX.
That said, Turning the whole contact form into a client-side loaded component with [the Astro client directive](https://docs.astro.build/ja/reference/directives-reference/) causes a serious CLS(Cumulative Layout Shifts) problem that could affect SEO badly. With that in mind, I made a detour and ended up putting it in a modal component.

To make it simple and concise, I utilized [the Modular Forms](https://modularforms.dev/), [Kobalte](https://kobalte.dev/docs/core/overview/introduction), [Valibot](https://valibot.dev/), and other useful libraries.
Here are some points:

- The client side validation
  - The Modular Forms x Valibot x Cloudflare Turnstile
- The server side validation
  - The Valibot x Cloudflare Turnstile
- The submit button label changes when submitting
  - This feature can easily be topped thanks to the form control of the Modular Forms

For bot management, I got hung up on the Cloudflare Turnstile compared to the notorious Google reCAPTCHA. (I never forget the wasted time solving the car puzzles...) It's free and fully compatible with other Cloudflare services, so I had no other choice.

> [!warning] Caution
> Since contact forms require user interactions, they must be rendered on the client side, which in turn requires you to change your Astro project's configuration from full SSG to partial SSG (hybrid SSR, so to speak). it's a bit tricky in that some libraries cannot work due to the difference between server and client.

### Cloudflare

#### Cloudflare Pages

When I was into [Next.js](https://nextjs.org/), my go-to hosting service was [Vercel](https://vercel.com/), but it felt like I needed to revisit it along with the transition to Astro. I came to a conclusion: [Cloudflare Pages](https://developers.cloudflare.com/pages/).

##### Why Cloudflare Pages?

I decided to use Cloudflare Pages to host my website for the following reasons:

- The generous free plan
  - The unlimited maximum bandwidth per month is awesome (As of May 9, 2024)
- Lightning fast deployment
- Custom email addresses for your domain available
- Own domains available (paid)

I suppose the free plan suffices for a small project like my website. That's the most appealing factor to me.

#### Cloudflare D1

### Front Matter CMS

Along with a choice of framework, what takes you ages to decide is that of CMS(Content Management System). I fell in love with [Front Matter CMS](https://frontmatter.codes/) for the following reasons:

- Writing and storing articles in local
- Markdown/MDX file format

It's unlike other headless CMS in that it's a VS Code extension and works in local, in your code editor! This centralizes all the editing work: code tweaks, blog writing, and deployment. I believe it'd especially be a huge advantage to developers.

When it comes to the setup, consult [the Front Matter official doc](https://frontmatter.codes/docs/getting-started). During the procedure, it automatically detects Astro's content folder and creates each content's fields' definitions in the `frontmatter.json` accordingly.

#### Customization of Front Matter CMS

In the `frontmatter.json` configuration, there are some notable points:

- `frontMatter.content.publicFolder`: it refers to the public folder by default. I wanted to use [the asset directory](https://docs.astro.build/ja/guides/images/) Astro offers for image optimization, so changed it to `src/assets/images/`
- `frontMatter.content.i18n`: Front Matter CMS also covers an i18n feature. With this setting, it can spot the association between locales and directories

My dashboard looks like this. It's fully comparable to other CMS, isn't it?

![ My Front Matter CMS dashboard (List appearance) ](../../../assets/images/front-matter-cms-dashboard.png)

![ My Front Matter CMS editing mode ](../../../assets/images/front-matter-cms-editing.png)

## Outro

Over the course of my development journey, I consulted a bunch of information sources. I wouldn't be able to complete it if it hadn't been for them. Here are some of them that I visited very often. Thank you so much for your helpful information and code!
